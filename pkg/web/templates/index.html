<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>进程监控自启 Ouroboros</title>
    <!-- Include Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/lumen/bootstrap.min.css" rel="stylesheet">
    <style>
        .table td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>


<main>
    <div class="container">
        <nav class="navbar navbar-expand-lg bg-light justify-content-center" data-bs-theme="light">
            <div class="navbar-nav d-flex">
                <a href="/">
                    <svg xmlns="http://www.w3.org/2000/svg" height="43" width="52.5" viewBox="0 0 640 512">
                        <g class="layer">
                            <g fill="#894F3F" id="svg_1" stroke-width="0" transform="rotate(90 401 302)">
                                <g fill="#000000" id="svg_2" transform="translate(0 460) scale(0.1 -0.1)">
                                    <path d="m4050.31,3869.05c0,-3 32,-106 70,-228c39,-123 70,-226 70,-230c0,-4 -26,14 -57,41c-32,26 -68,54 -81,61c-38,21 -172,35 -287,29c-333,-18 -633,-147 -860,-372c-205,-202 -323,-421 -376,-697c-39,-205 -11,-504 60,-634c12,-21 19,-30 17,-19c-52,203 -51,196 -51,380c0,158 3,191 24,270c27,101 84,246 112,287c11,14 19,29 19,33c0,16 94,138 165,214c207,219 487,352 776,368c134,8 155,-8 43,-31c-239,-49 -451,-161 -625,-327c-327,-314 -382,-788 -135,-1172c61,-94 195,-237 272,-291c155,-106 238,-150 369,-196c94,-33 253,-74 368,-96c235,-45 515,-142 634,-220c176,-117 248,-358 168,-570c-55,-146 -167,-247 -355,-320c-363,-140 -790,-47 -1065,231c-70,71 -155,187 -155,211c0,9 22,14 76,16l76,3l-109,95c-59,52 -128,114 -153,138c-24,23 -48,42 -51,42c-4,0 -22,-24 -40,-52c-52,-81 -88,-118 -115,-118c-13,0 -24,3 -24,6c0,5 52,104 118,224c13,25 47,89 74,142c62,123 94,152 160,146c55,-6 54,2 -8,38c-37,22 -51,25 -77,17c-40,-11 -85,-70 -122,-159c-30,-73 -64,-117 -106,-139c-40,-21 -136,-28 -237,-16c-94,10 -138,4 -154,-22c-4,-7 -33,-44 -64,-84l-58,-72l-28,15c-45,23 -104,81 -118,114c-26,63 12,132 127,225c69,56 46,60 -55,10c-107,-54 -155,-139 -137,-248c17,-98 74,-163 179,-203c130,-50 147,-80 249,-439l34,-120l33,48c59,83 71,56 41,-97c-12,-61 -21,-122 -21,-136c0,-42 157,-210 335,-359c137,-115 414,-285 433,-267c3,4 -65,77 -150,164c-86,86 -174,178 -198,204c-41,46 -41,47 -18,52c226,50 407,26 520,-69c34,-29 33,-29 -47,-10c-73,18 -190,19 -235,3l-34,-11l75,-35c97,-44 198,-79 282,-97c132,-29 235,-104 301,-222c12,-20 26,-36 31,-34c13,3 16,-8 -64,245l-69,219l56,-56c94,-91 97,-92 322,-92c182,0 202,2 305,29c170,45 297,100 435,192c347,230 574,648 573,1054c-1,159 -37,347 -83,430l-20,35l6,-30c3,-16 12,-52 19,-80c61,-228 41,-524 -51,-743c-137,-325 -431,-587 -773,-687c-101,-29 -242,-46 -312,-35c-50,7 -52,6 88,44c418,117 695,362 819,726c27,80 29,94 29,250c0,156 -2,170 -29,250c-105,309 -310,531 -630,684c-82,39 -242,95 -321,111c-84,18 -468,123 -586,160c-167,52 -259,115 -340,232c-69,99 -103,252 -79,354c60,261 293,435 627,471c369,39 726,-126 934,-429l49,-73l-87,0l-88,-1l40,-37c22,-20 76,-69 120,-108c44,-40 98,-88 120,-108c22,-19 43,-36 46,-36c3,0 31,35 62,79c38,53 65,81 83,85c50,13 53,23 -83,-234c-155,-291 -156,-293 -231,-284l-47,6l33,-31c39,-37 86,-41 124,-11c35,27 82,103 108,173c42,111 127,145 319,127c63,-6 121,-8 130,-5c10,3 48,43 86,90c37,47 73,85 79,85c21,-1 107,-71 126,-103c11,-18 20,-46 20,-63c0,-44 -49,-114 -119,-169c-33,-26 -61,-50 -61,-52c0,-10 69,11 113,35c95,51 135,127 123,230c-12,105 -73,179 -173,213c-49,16 -78,33 -108,65c-47,48 -71,112 -141,367l-38,138l-35,-56c-38,-61 -46,-59 -57,13c-5,31 0,63 20,125c22,69 25,89 16,112c-15,39 -297,319 -390,387c-105,77 -184,128 -263,171c-157,85 -154,80 66,-141l209,-209l-44,-16c-112,-43 -237,-45 -358,-6c-62,19 -170,83 -170,99c0,4 28,-1 63,-12c120,-37 341,-18 245,22c-13,5 -55,22 -93,39c-39,16 -128,46 -200,66c-71,20 -148,48 -171,61c-53,31 -110,93 -154,167c-30,50 -50,70 -50,51zm752,-869c44,-20 99,-48 122,-64c59,-41 128,-113 118,-123c-7,-7 -89,15 -249,67c-7,2 -12,20 -11,40c1,31 -5,42 -43,75c-24,22 -38,39 -31,40c8,0 50,-16 94,-35zm-1717,-2700c44,-13 99,-29 122,-35c41,-10 42,-11 36,-47c-6,-33 -3,-39 43,-80c58,-52 42,-51 -74,2c-82,39 -130,73 -182,129c-60,65 -58,66 55,31z" fill="#d33030" id="svg_3"/>
                                </g>
                            </g>
                        </g>
                    </svg>
                </a>
                <h4 class="mt-2">进程监控自启 - Ouroboros</h4>
            </div>
        </nav>

    </div>
</main>

<body class="d-flex flex-column min-vh-100">
    <div class="container row mt-3">
        <div class="col col-md-8 offset-md-3 row align-items-start">
            <div class="input-group">
                <span class="input-group-text" id="basic-addon1">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path>
                  </svg>
                </span>
                <input class="form-control me-2" type="search" placeholder="支持搜索 pid、进程名、进程参数" id="search-input" >
                <button id="refreshButton" type="button" class="btn btn-outline-dark">
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512"><path d="M370.7 133.3C339.5 104 298.9 88 255.8 88c-77.5 .1-144.3 53.2-162.8 126.9-1.3 5.4-6.1 9.2-11.7 9.2H24.1c-7.5 0-13.2-6.8-11.8-14.2C33.9 94.9 134.8 8 256 8c66.4 0 126.8 26.1 171.3 68.7L463 41C478.1 25.9 504 36.6 504 57.9V192c0 13.3-10.7 24-24 24H345.9c-21.4 0-32.1-25.9-17-41l41.8-41.7zM32 296h134.1c21.4 0 32.1 25.9 17 41l-41.8 41.8c31.3 29.3 71.8 45.3 114.9 45.3 77.4-.1 144.3-53.1 162.8-126.8 1.3-5.4 6.1-9.2 11.7-9.2h57.3c7.5 0 13.2 6.8 11.8 14.2C478.1 417.1 377.2 504 256 504c-66.4 0-126.8-26.1-171.3-68.7L49 471C33.9 486.1 8 475.4 8 454.1V320c0-13.3 10.7-24 24-24z"/></svg>
                    </span>
                </button>
            </div>
        </div>
    </div>
    <div class="container mt-3 overflow-auto">
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th>USER(用户)</th>
                <th>PID(进程ID)</th>
                <th>Command(进程命令)</th>
                <th>CommandArgs(进程命令参数)</th>
                <th>START(进程开始时间)</th>
                <th>TIME(CPU时间)</th>
                <th>%CPU(CPU使用率)</th>
                <th>%MEM(内存使用率)</th>
                <th>VSZ(虚拟内存大小)</th>
                <th>RSS(物理内存大小)</th>
                <th>TTY(终端类型)</th>
                <th>STAT(进程状态)</th>
                <th></th>
            </tr>
            </thead>
            <tbody class="list-item">
            {{range $i, $process := .MonitorProcess}}
            <tr class="table-success">
                <td scope="row">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" checked=""/>
                    </div>
                </td>
                <td>{{ $process.User }}</td>
                <td>{{ $process.Pid }}</td>
                <td class="text-truncate" style="max-width: 150px;" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="{{ $process.Command }}">{{ $process.Command }}</td>
                <td class="text-truncate" style="max-width: 200px;" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="{{ $process.CommandArr }}">{{ $process.CommandArr }}</td>
                <td>{{ $process.Start }}</td>
                <td>{{ $process.Time }}</td>
                <td>{{ $process.Cpu }}</td>
                <td>{{ $process.Mem }}</td>
                <td>{{ $process.VsZ }}</td>
                <td>{{ $process.Rss }}</td>
                <td>{{ $process.Tty }}</td>
                <td>{{ $process.Stat }}</td>
                {{ if gt $process.Counter 0 }}
                <td> <span class="badge bg-danger rounded-pill">{{ $process.Counter }}</span> </td>
                {{ end }}
            </tr>
            {{end}}

            {{range $i, $process := .process}}
            <tr>
                <td scope="row">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value=""/>
                    </div>
                </td>
                <td>{{ $process.User }}</td>
                <td>{{ $process.Pid }}</td>
                <td class="text-truncate" style="max-width: 150px;" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="{{ $process.Command }}">{{ $process.Command }}</td>
                <td class="text-truncate" style="max-width: 200px;" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="{{ $process.CommandArr }}">{{ $process.CommandArr }}</td>
                <td>{{ $process.Start }}</td>
                <td>{{ $process.Time }}</td>
                <td>{{ $process.Cpu }}</td>
                <td>{{ $process.Mem }}</td>
                <td>{{ $process.VsZ }}</td>
                <td>{{ $process.Rss }}</td>
                <td>{{ $process.Tty }}</td>
                <td>{{ $process.Stat }}</td>
                {{ if gt $process.Counter 0 }}
                <td> <span class="badge bg-danger rounded-pill">{{ $process.Counter }}</span> </td>>
                {{ end }}
            </tr>
            {{end}}
            </tbody>
        </table>
    </div>

    
    <footer class="bg-black bg-body-tertiary text-center mt-auto">
        <div class="container">
            © {{ .year}} Copyright:
            <a class="text-dark" href="https://github.com/yhy0/Ouroboros" target="_blank">yhy - Ouroboros</a>
        </div>
    </footer>

    <!-- Include Bootstrap 5 JS (Optional, if needed) -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>

    <script>
        // 在按钮点击时刷新页面
        document.getElementById('refreshButton').addEventListener('click', function() {
            location.reload(); // 刷新页面
        });

        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    </script>
    <script>

        const host = window.location.hostname;
        const port = "{{ .webPort }}";
        const socket = new WebSocket(`ws://${host}:${port}/ws`);

        document.addEventListener('change', function (event) {
            if (event.target.type === 'checkbox' && event.target.className === 'form-check-input') {
                const checkboxValue = event.target.checked;
                const pid = event.target.closest('tr').querySelector('td:nth-child(3)').textContent;

                socket.send(JSON.stringify({ pid, checkboxValue }));
            }
        });
    </script>

    <script>
        document.getElementById('search-input').addEventListener('input', function (event) {
            const searchTerm = event.target.value.trim(); // 获取并清除输入框两边的空格
            const listItems = document.querySelectorAll('.list-item tr');

            if (searchTerm.length > 0) {
                listItems.forEach(function (item) {
                    const cells = item.getElementsByTagName('td');
                    let found = false;

                    const user = cells[1].textContent.toLowerCase();
                    const pid = cells[2].textContent.toLowerCase();
                    const cmd = cells[3].textContent.toLowerCase();
                    const cmdArgs = cells[4].textContent.toLowerCase();

                    if (user.includes(searchTerm.toLowerCase()) || pid.includes(searchTerm.toLowerCase()) || cmd.includes(searchTerm.toLowerCase()) || cmdArgs.includes(searchTerm.toLowerCase())) {
                        found = true;
                    }

                    if (found) {
                        item.style.display = ''; // 符合搜索条件，显示行
                    } else {
                        item.style.display = 'none'; // 不符合搜索条件，隐藏行
                    }
                });
            } else {
                listItems.forEach(function (item) {
                    item.style.display = ''; // 如果搜索框为空，显示所有项
                });
            }
        });
    </script>
</body>
</html>
